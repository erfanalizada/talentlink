name: CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    # Log in to GHCR
    - name: Log in to GitHub Container Registry
      run: echo "${{ secrets.GHCR_TOKEN }}" | docker login ghcr.io -u "${{ secrets.GHCR_USERNAME }}" --password-stdin

    # Build Backend Docker Image
    - name: Build backend Docker image
      run: |
        docker build -t ghcr.io/${{ secrets.GHCR_USERNAME }}/backend:latest ./backend

    # Build Frontend Docker Image
    - name: Build frontend Docker image
      run: |
        docker build -t ghcr.io/${{ secrets.GHCR_USERNAME }}/frontend:latest ./frontend

    # Push Backend Image
    - name: Push backend Docker image
      run: docker push ghcr.io/${{ secrets.GHCR_USERNAME }}/backend:latest

    # Push Frontend Image
    - name: Push frontend Docker image
      run: docker push ghcr.io/${{ secrets.GHCR_USERNAME }}/frontend:latest


#What this does

#Every time you push to main or make a pull request → GitHub will:

#Checkout your code.

#Try to build backend/Dockerfile.

#Try to build frontend/Dockerfile.

#If both builds succeed → CI passes (green checkmark).

#If one fails → CI fails (red).